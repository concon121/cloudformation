        BuildSpec:
          "version: 0.2\n\nphases:\n  build:\n    commands:\n      - sudo apt-get update -y\
          \n      - sudo apt-get install libfile-mimeinfo-perl zip unzip jq -y\
          \n      - for file in `cd ${ROOT_DIRECTORY} && find * -type f`; \
          do aws s3api put-object --key \"${file}\" --bucket $S3_BUCKET --grant-read uri=http://acs.amazonaws.com/groups/global/AllUsers --body \"${ROOT_DIRECTORY}/${file}\" --content-type `/usr/bin/mimetype -b \"${ROOT_DIRECTORY}/${file}\"`; done\
<% if @cloudfront && !@cloudfront.nil? %>
          \n      - aws configure set preview.cloudfront true\
          \n      - aws cloudfront create-invalidation --distribution-id $CLOUDFRONT_DIST_ID --paths \"/*\"\
<% end %>
          \n      - exists=`aws s3api list-objects --bucket $S3_BUCKET | jq -r '.Contents[].Key' | grep $RELEASE_NAME || :`
          \n      - if [ ! -z $exists ]; then aws s3api get-object --bucket $S3_BUCKET --key $RELEASE_NAME $RELEASE_NAME; fi \
          \n      - if [ `echo $?` -eq 0 ]; then unzip -n $RELEASE_NAME; fi\
          \n      - zip -r ${RELEASE_NAME} ${ROOT_DIRECTORY} \
          \n      - aws s3api put-object --key $RELEASE_NAME --bucket $S3_BUCKET --grant-read uri=http://acs.amazonaws.com/groups/global/AllUsers --body \"${RELEASE_NAME}\" --content-type `/usr/bin/mimetype -b \"${RELEASE_NAME}\"`"
