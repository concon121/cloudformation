  <%= @id %>:
    Type: "AWS::S3::Bucket"
    Properties:
      AccessControl: PublicReadWrite
      BucketName: <%= @bucketName %>
      VersioningConfiguration:
        Status: 'Enabled'
      WebsiteConfiguration:
        IndexDocument: !Ref 'IndexDocument'

  <%= @id %>Policy:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: <%= @id %>
      PolicyDocument:
        Statement:
        - Sid: 'AllowUsers'
          Effect: <% if @s3IpWhiteList && !@s3IpWhiteList.nil? %>Deny<% else %>Allow<% end %>
          Principal: '*'
          Action: s3:*
          Resource: !Join ['', ['arn:aws:s3:::', <%= @bucketName %>, /*]]
          <% if @s3IpWhiteList && !@s3IpWhiteList.nil? %>
          Condition:
            NotIpAddress:
              aws:SourceIp: <% @s3IpWhiteList.each do |ip| %>
                - <%= ip['value'] %> <% end %>
          <% end %>
