  <%= @id %>:
    Type: "AWS::S3::Bucket"
    Properties:
      AccessControl: PublicReadWrite
      BucketName: <%= @bucketName %>
      #!If
      #  - 'CreateSubDomains'
      #  - !Join ['.', ['www', <%= @tag %>, !Ref 'ProjectName', !Ref 'RootDomain']]
      #  - !Join ['.', ['www', <%= @tag %>, !Ref 'ProjectName']]
      VersioningConfiguration:
        Status: 'Enabled'
      WebsiteConfiguration:
        IndexDocument: !Ref 'IndexDocument'

  <%= @id %>Policy:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: AppBucket
      PolicyDocument:
        Statement:
        - Sid: IPAllow
          Effect: Deny
          Principal: '*'
          Action: s3:GetObject
          Resource: !Join ['', ['arn:aws:s3:::', !Ref 'AppBucket', /*]]
          Condition:
            IpAddress:
              aws:SourceIp: !Ref 'AllowedIPRange'
