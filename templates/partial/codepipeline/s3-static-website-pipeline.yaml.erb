<% appOutput = 'app-source' %>

  <%= @id %>:
    Type: "AWS::CodePipeline::Pipeline"
    DependsOn:
      - PipelineRole
    Properties:
      Name: !Sub 'pr52-cp-<%= @projectName %>${ProjectName}-pipeline-<%= @tag %>'
      RoleArn: !GetAtt [<%= @role %>, Arn]
      ArtifactStore:
        Location:
          Ref: <%= @stagingBucket %>
        Type: "S3"
      Stages:
        - Name: "Source"
          Actions:
<%= partial('codepipeline/stages/codecommit.yaml.erb',
            name: 'ApplicationSource',
            output: appOutput) %>
        - Name: 'Deployment'
          Actions:
<%= partial('codepipeline/stages/s3-upload-codebuild.yaml.erb',
            name: 'DeployApp',
            input: appOutput) %>
