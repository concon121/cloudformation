---
AWSTemplateFormatVersion: 2010-09-09
Parameters:
  AllowedIPRange:
    Description: IP addresses allowed to access the static website, in CIDR notation.
    Type: String
  ProjectName:
    Description: The name of the project
    Type: String
  RootDomainZoneID:
    Description: The zone ID of the root domain
    Type: String
    Default: ''
  RootDomain:
    Description: The root domain
    Type: String
  UserRole:
    Description: The role that resource access policies will be applied to.
    Type: String
  IndexDocument:
    Description: The index document for static S3 websites
    Type: String
    Default: index.html
  WebsiteRootDirectory:
    Description: The directory in code commit containing the index file
    Type: String
    Default: '.'

Resources:
<%= partial('cloudformation/stack.yaml.erb',
            id: "DevelopmentStack",
            url: "!Join [\'/\', [!Ref \'NestedStackS3Bucket\', \'stacks/pipeline/development-sad-pipeline.yaml\']]",
            params: [{'key' => 'ProjectName', 'value': '!Ref ProjectName'},
                     {'key' => 'AllowedIPRange', 'value' => '!Ref AllowedIPRange'},
                     {'key' => 'UserRole', 'value' => '!Ref UserRole'},
                     {'key' => 'IndexDocument', 'value' => '!Ref IndexDocument'},
                     {'key' => 'WebsiteRootDirectory', 'value' => '!Ref WebsiteRootDirectory'}]) %>
<%= partial('cloudformation/stack.yaml.erb',
            id: "TestStack",
            url: "!Join [\'/\', [!Ref \'NestedStackS3Bucket\', \'stacks/pipeline/test-sad-pipeline.yaml\']]",
            params: [{'key' => 'ProjectName', 'value': '!Ref ProjectName'},
                     {'key' => 'AllowedIPRange', 'value' => '!Ref AllowedIPRange'},
                     {'key' => 'UserRole', 'value' => '!Ref UserRole'},
                     {'key' => 'IndexDocument', 'value' => '!Ref IndexDocument'},
                     {'key' => 'WebsiteRootDirectory', 'value' => '!Ref WebsiteRootDirectory'}]) %>
<%= partial('cloudformation/stack.yaml.erb',
            id: "ProductionStack",
            url: "!Join [\'/\', [!Ref \'NestedStackS3Bucket\', \'stacks/pipeline/production-sad-pipeline.yaml\']]",
            params: [{'key' => 'ProjectName', 'value': '!Ref ProjectName'},
                     {'key' => 'RootDomainZoneID', 'value' => '!Ref RootDomainZoneID'},
                     {'key' => 'RootDomain', 'value' => '!Ref RootDomain'},
                     {'key' => 'AllowedIPRange', 'value' => '!Ref AllowedIPRange'},
                     {'key' => 'UserRole', 'value' => '!Ref UserRole'},
                     {'key' => 'IndexDocument', 'value' => '!Ref IndexDocument'},
                     {'key' => 'WebsiteRootDirectory', 'value' => '!Ref WebsiteRootDirectory'}]) %>
